<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>阿胖早點後台</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">

<header class="bg-red-600 text-white p-4 text-center font-bold text-xl">阿胖早點 - 後台訂單管理</header>

<main class="container mx-auto p-4">
  <div id="orders-container" class="space-y-6"></div>
</main>

<script>
const GAS_API_URL="https://script.google.com/macros/s/AKfycb.../exec"; // 替換你的實際 URL
const TOKEN="123456"; // 管理密碼 token

async function loadOrders(){
  const res=await fetch(GAS_API_URL,{
    method:"POST",
    headers:{"Content-Type":"text/plain;charset=utf-8"},
    body:JSON.stringify({action:"getPendingOrdersMerged", token:TOKEN})
  });
  const data=await res.json();
  if(!data.ok){ alert(data.message); return; }
  displayOrders(data.data);
}

function displayOrders(orders){
  const container=document.getElementById("orders-container");
  container.innerHTML="";
  orders.forEach(order=>{
    const div=document.createElement("div");
    div.className="bg-white p-4 rounded shadow";
    div.id="table-"+order.table;

    let itemsHtml="";
    order.items.forEach(it=>{
      itemsHtml+=`<p>${it.item} x ${it.qty} - $${it.subtotal}</p>`;
    });

    div.innerHTML=`
      <h3 class="font-bold text-lg mb-2">桌號 ${order.table} - 總計 $${order.total}</h3>
      <div class="mb-2">${itemsHtml}</div>
      <div class="flex gap-2">
        <button class="bg-orange-500 text-white px-3 py-1 rounded" onclick="markServed('${order.table}', this)">送餐</button>
        <button class="bg-green-600 text-white px-3 py-1 rounded" onclick="markPaid('${order.table}', this)">結帳</button>
      </div>
    `;
    container.appendChild(div);
  });
}

// 標記送餐
async function markServed(table, btn){
  const res=await fetch(GAS_API_URL,{
    method:"POST",
    headers:{"Content-Type":"text/plain;charset=utf-8"},
    body:JSON.stringify({action:"markTableServed", table, token:TOKEN})
  });
  const data=await res.json();
  if(data.ok){ btn.innerText="已送餐"; btn.disabled=true; } else alert(data.message);
}

// 標記結帳
async function markPaid(table, btn){
  const res=await fetch(GAS_API_URL,{
    method:"POST",
    headers:{"Content-Type":"text/plain;charset=utf-8"},
    body:JSON.stringify({action:"markTablePaid", table, token:TOKEN})
  });
  const data=await res.json();
  if(data.ok){
    btn.innerText="已結帳"; btn.disabled=true;
    const div=document.getElementById("table-"+table);
    if(div) div.remove();
  } else alert(data.message);
}

// 初始載入
loadOrders();
setInterval(loadOrders,5000); // 每5秒自動刷新
</script>

</body>
</html>
